<!DOCTYPE html>
<html lang="ko">
<head>
  <base target="_top">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="icon" type="image/png" href="/favicon.png" />
  <title>발주시스템 안내</title>
  <style>
    body { 
      font-family: 'Noto Sans KR', -apple-system, sans-serif; 
      background: #f8f9fa; 
      color: #212529; 
      margin: 0;
      padding: 0;
    }

    .hero {
      min-height: calc(100vh - 200px);
      padding: 40px 20px; 
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    }
    
    .card { 
      max-width: 1400px; 
      margin: 0 auto;
      background: white; 
      border-radius: 16px; 
      padding: 40px; 
      box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
    }
    
    .eyebrow { 
      font-size: 14px; 
      font-weight: 700; 
      letter-spacing: .06em; 
      color: #6c757d; 
      text-transform: uppercase; 
      margin-bottom: 12px; 
    }
    
    .title { 
      font-size: 36px; 
      line-height: 1.25; 
      font-weight: 800; 
      color: #212529; 
      margin-bottom: 16px; 
    }
    
    .subtitle { 
      font-size: 16px; 
      color: #495057; 
      line-height: 1.6;
      margin-bottom: 28px; 
    }

    .cta-wrap { 
      display: flex; 
      gap: 12px; 
      align-items: center; 
      margin-bottom: 40px;
    }

    .special-order-btn {
      padding: 14px 32px; 
      border: none; 
      border-radius: 8px; 
      font-weight: 700; 
      font-size: 18px; 
      cursor: pointer;
      background: #2563eb;
      color: white;
      transition: all 0.2s;
    }
    
    .special-order-btn:hover { 
      background: #1d4ed8;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    .divider {
      width: 100%;
      height: 1px;
      background: #dee2e6;
      margin: 40px 0;
    }

    .form-title {
      font-size: 24px;
      font-weight: 700;
      color: #212529;
      margin-bottom: 8px;
      text-align: center;
    }

    .form-subtitle {
      font-size: 14px;
      color: #6c757d;
      text-align: center;
      margin-bottom: 30px;
    }

    /* 상품 섹션 - 한 줄 레이아웃 */
    .product-section {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }

    .search-input-wrapper {
      position: relative;
    }

    .product-search {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      font-size: 14px;
      transition: all 0.2s;
    }

    .product-search:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .search-results {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      background: white;
      display: none;
      z-index: 100;
      margin-top: 5px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .search-results.active {
      display: block;
    }

    .search-result-item {
      padding: 12px 16px;
      cursor: pointer;
      border-bottom: 1px solid #f1f3f5;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background 0.2s;
    }

    .search-result-item:hover {
      background: #f8f9fa;
    }

    .search-result-item:last-child {
      border-bottom: none;
    }

    .result-option {
      font-size: 14px;
      color: #212529;
      font-weight: 500;
    }

    .result-price {
      font-size: 14px;
      color: #2563eb;
      font-weight: 600;
    }

    .order-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    /* 2칼럼 레이아웃 (2:8 비율) */
    .two-column-layout {
      display: grid;
      grid-template-columns: 2fr 8fr;
      gap: 30px;
      margin-top: 20px;
    }

    .column-title {
      font-size: 16px;
      font-weight: 700;
      color: #212529;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #dee2e6;
    }

    /* 판매자 정보 칼럼 */
    .seller-column {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    /* 주문서 칼럼 */
    .order-column {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    /* 주문자/수령인 정보 한 줄 - 조정된 너비 */
    .order-info-row {
      display: grid;
      grid-template-columns: 0.4fr 0.7fr 0.4fr 0.7fr 1.8fr;
      gap: 15px;
    }

    /* 배송 정보 행 */
    .delivery-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    /* 총액 및 버튼 섹션 */
    .bottom-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }

    .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      align-items: center;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .form-label {
      font-size: 13px;
      color: #495057;
      font-weight: 600;
    }

    .form-label .required {
      color: #dc3545;
    }

    .form-input {
      padding: 10px 14px;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      font-size: 14px;
      color: #212529;
      background: white;
      transition: all 0.2s;
    }

    .form-input:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .form-input:disabled {
      background: #f8f9fa;
      color: #6c757d;
      cursor: not-allowed;
    }

    .form-input.error {
      border-color: #dc3545;
    }

    textarea.form-input {
      resize: vertical;
      min-height: 40px;
    }

    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      opacity: 1;
      height: 30px;
    }

    .price-display {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .price-label {
      font-size: 14px;
      color: #6c757d;
      margin-bottom: 8px;
    }

    .price-amount {
      font-size: 28px;
      font-weight: 700;
      color: #212529;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-reset {
      background: #f8f9fa;
      color: #495057;
      border: 1px solid #dee2e6;
    }

    .btn-reset:hover {
      background: #e9ecef;
    }

    .btn-submit {
      background: #2563eb;
      color: white;
    }

    .btn-submit:hover {
      background: #1d4ed8;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    .btn-submit:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .phone-contact {
      text-align: center;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #dee2e6;
      font-size: 14px;
      color: #6c757d;
    }

    .phone-link {
      color: #2563eb;
      text-decoration: none;
      font-weight: 600;
      margin-left: 6px;
    }

    .phone-link:hover {
      text-decoration: underline;
    }

    /* 모달 스타일 */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      padding: 30px;
    }

    .modal-header {
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid #dee2e6;
    }

    .modal-title {
      font-size: 24px;
      font-weight: 700;
      color: #212529;
      margin-bottom: 8px;
    }

    .modal-subtitle {
      font-size: 14px;
      color: #6c757d;
    }

    .order-summary {
      margin-bottom: 20px;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #f1f3f5;
    }

    .summary-label {
      font-size: 14px;
      color: #6c757d;
    }

    .summary-value {
      font-size: 14px;
      color: #212529;
      font-weight: 500;
    }

    .summary-total {
      display: flex;
      justify-content: space-between;
      padding: 15px 0;
      margin-top: 10px;
      border-top: 2px solid #dee2e6;
    }

    .summary-total .summary-label {
      font-size: 16px;
      font-weight: 700;
      color: #212529;
    }

    .summary-total .summary-value {
      font-size: 18px;
      font-weight: 700;
      color: #2563eb;
    }

    .account-section {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }

    .account-title {
      font-size: 16px;
      font-weight: 700;
      color: #212529;
      margin-bottom: 15px;
      text-align: center;
    }

    .account-info {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      padding: 15px;
      position: relative;
    }

    .account-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .account-row:last-child {
      margin-bottom: 0;
    }

    .account-label {
      font-size: 13px;
      color: #6c757d;
    }

    .account-value {
      font-size: 14px;
      color: #212529;
      font-weight: 600;
    }

    .account-number {
      background: #e7f3ff;
      padding: 12px;
      border-radius: 6px;
      text-align: center;
      margin-top: 10px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .account-number:hover {
      background: #cce5ff;
    }

    .account-number-text {
      font-size: 16px;
      font-weight: 700;
      color: #004085;
      letter-spacing: 0.5px;
    }

    .copy-hint {
      font-size: 11px;
      color: #6c757d;
      margin-top: 5px;
    }

    .copy-success {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #28a745;
      color: white;
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 13px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .copy-success.show {
      opacity: 1;
    }

    .modal-footer {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .modal-btn {
      flex: 1;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .modal-btn-secondary {
      background: #f8f9fa;
      color: #495057;
      border: 1px solid #dee2e6;
    }

    .modal-btn-secondary:hover {
      background: #e9ecef;
    }

    .modal-btn-primary {
      background: #2563eb;
      color: white;
    }

    .modal-btn-primary:hover {
      background: #1d4ed8;
    }

    /* 모바일 반응형 */
    @media (max-width: 1024px) {
      .product-section {
        grid-template-columns: 1fr;
      }
      
      .two-column-layout {
        grid-template-columns: 1fr;
      }
      
      .order-info-row {
        grid-template-columns: 1fr;
      }
      
      .delivery-row {
        grid-template-columns: 1fr;
      }
      
      .bottom-section {
        grid-template-columns: 1fr;
      }
      
      .button-group {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (max-width: 640px) {
      .hero {
        padding: 20px 15px;
      }
      
      .card {
        padding: 25px 20px;
        border-radius: 12px;
      }
      
      .title {
        font-size: 28px;
      }
      
      .subtitle {
        font-size: 14px;
      }
      
      .special-order-btn {
        width: 100%;
        font-size: 16px;
        padding: 12px 20px;
      }

      .price-amount {
        font-size: 24px;
      }

      .button-group {
        grid-template-columns: 1fr;
      }

      .modal-content {
        width: 95%;
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <!-- 공통 헤더 컨테이너 -->
  <div id="header-container"></div>

  <!-- 본문 -->
  <main class="hero">
    <section class="card">
      <div class="eyebrow">Order Guide</div>
      <h1 class="title">주문은 <strong style="color:#2563eb">발주시스템</strong>을 이용해 주세요</h1>
      <p class="subtitle">
        다수의 주문은 발주시스템을 이용하시면 더욱 편리합니다.<br>
        정확한 주문관리 정산을 위해 발주시스템을 이용해주세요.
      </p>

      <div class="cta-wrap">
        <button class="special-order-btn" onclick="window.open('https://papafarmers.com/orders/', '_blank')">
          발주시스템 바로가기
        </button>
      </div>

      <div class="divider"></div>

      <!-- 주문 폼 -->
      <div class="order-form-section">
        <h2 class="form-title">빠른 주문서</h2>
        <p class="form-subtitle">간편하게 주문하실 수 있습니다</p>

        <form class="order-form" id="quickOrderForm">
          <!-- 상품 검색 및 정보 한 줄 -->
          <div class="product-section">
            <div class="form-group">
              <label class="form-label">상품 검색 <span class="required">*</span></label>
              <div class="search-input-wrapper">
                <input type="text" class="form-input product-search" id="productSearch" 
                       placeholder="상품명, 품종, 옵션명으로 검색..." 
                       oninput="searchProducts(this.value)"
                       onfocus="if(this.value.length >= 2) searchProducts(this.value)">
                <div class="search-results" id="searchResults"></div>
              </div>
            </div>
            
            <div class="form-group">
              <label class="form-label">옵션명</label>
              <input type="text" class="form-input" id="optionName" readonly>
            </div>
            
            <div class="form-group">
              <label class="form-label">규격</label>
              <input type="text" class="form-input" id="productSpec" readonly>
            </div>
            
            <div class="form-group">
              <label class="form-label">단가</label>
              <input type="text" class="form-input" id="unitPrice" readonly>
            </div>
            
            <div class="form-group">
              <label class="form-label">수량 <span class="required">*</span></label>
              <input type="number" class="form-input" id="quantity" min="1" value="1" required onchange="calculateTotal()">
            </div>
          </div>

          <div class="divider"></div>

          <!-- 2칼럼 레이아웃 (2:8 비율) -->
          <div class="two-column-layout">
            <!-- 판매자 정보 칼럼 (2) -->
            <div class="seller-column">
              <h3 class="column-title">판매자 정보</h3>
              <div class="form-group">
                <label class="form-label">판매자 <span class="required">*</span></label>
                <input type="text" class="form-input" id="sellerName" placeholder="판매자" required minlength="2">
              </div>
              <div class="form-group">
                <label class="form-label">판매자 연락처 <span class="required">*</span></label>
                <input type="tel" class="form-input" id="sellerPhone" placeholder="010-0000-0000" required>
              </div>
            </div>

            <!-- 주문서 칼럼 (8) -->
            <div class="order-column">
              <h3 class="column-title">주문서</h3>
              
              <!-- 주문자/수령인 정보 한 줄 -->
              <div class="order-info-row">
                <div class="form-group">
                  <label class="form-label">주문자 <span class="required">*</span></label>
                  <input type="text" class="form-input" id="orderName" placeholder="주문자" required minlength="2">
                </div>
                <div class="form-group">
                  <label class="form-label">주문자 연락처 <span class="required">*</span></label>
                  <input type="tel" class="form-input" id="orderPhone" placeholder="010-0000-0000" required>
                </div>
                <div class="form-group">
                  <label class="form-label">수령인 <span class="required">*</span></label>
                  <input type="text" class="form-input" id="receiverName" placeholder="수령인" required minlength="2">
                </div>
                <div class="form-group">
                  <label class="form-label">수령인 연락처 <span class="required">*</span></label>
                  <input type="tel" class="form-input" id="receiverPhone" placeholder="010-0000-0000" required>
                </div>
                <div class="form-group">
                  <label class="form-label">주소 <span class="required">*</span></label>
                  <input type="text" class="form-input" id="address" placeholder="배송받을 주소" required>
                </div>
              </div>

              <!-- 배송 요청사항 및 메모 -->
              <div class="delivery-row">
                <div class="form-group">
                  <label class="form-label">배송 요청사항</label>
                  <input type="text" class="form-input" id="deliveryRequest" placeholder="배송 시 요청사항을 입력하세요">
                </div>
                <div class="form-group">
                  <label class="form-label">메모</label>
                  <input type="text" class="form-input" id="orderMemo" placeholder="메모를 입력하세요">
                </div>
              </div>

              <!-- 총액 및 버튼 섹션 -->
              <div class="bottom-section">
                <!-- 총 금액 -->
                <div class="price-display">
                  <div class="price-label">총 주문금액</div>
                  <div class="price-amount" id="totalAmount">0원</div>
                </div>

                <!-- 버튼 그룹 -->
                <div class="button-group">
                  <button type="button" class="btn btn-reset" onclick="resetForm()">초기화</button>
                  <button type="submit" class="btn btn-submit">주문 제출</button>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- 문의 전화번호 -->
      <div class="phone-contact">
        <span>문의</span>
        <a class="phone-link" href="tel:010-2688-1388">010-2688-1388</a>
      </div>
    </section>
  </main>

  <!-- 주문 확인 모달 -->
  <div class="modal" id="orderConfirmModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">주문 확인</h2>
        <p class="modal-subtitle">주문 내역을 확인해주세요</p>
      </div>
      
      <div class="order-summary" id="orderSummary">
        <!-- 주문 내역이 여기에 동적으로 추가됨 -->
      </div>
      
      <div class="account-section">
        <h3 class="account-title">입금 계좌 안내</h3>
        <div class="account-info">
          <div class="account-row">
            <span class="account-label">은행</span>
            <span class="account-value">농협</span>
          </div>
          <div class="account-row">
            <span class="account-label">예금주</span>
            <span class="account-value">남잠화</span>
          </div>
          <div class="account-number" onclick="copyAccountNumber()">
            <div class="account-number-text">302-1473-7870-91</div>
            <div class="copy-hint">클릭하여 계좌번호 복사</div>
            <div class="copy-success" id="copySuccess">복사되었습니다!</div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="modal-btn modal-btn-secondary" onclick="closeConfirmModal()">수정하기</button>
        <button class="modal-btn modal-btn-primary" onclick="finalSubmit()">확인</button>
      </div>
    </div>
  </div>

  <!-- 공통 푸터 컨테이너 -->
  <div id="footer-container"></div>

  <!-- 외부 스크립트 로드 -->
  <script src="header.js"></script>
  <script src="footer.js"></script>

  <script>
    // 전역 변수
    let allProducts = [];
    let selectedProduct = null;

    // 페이지 로드 시 초기화
    window.addEventListener('DOMContentLoaded', function() {
      // 헤더 초기화
      if (window.DalraeHeader) {
        DalraeHeader.init({
          containerId: 'header-container',
          activePage: 'orders'
        });
      }
      
      // 푸터 초기화
      if (window.DalraeFooter) {
        DalraeFooter.init({
          containerId: 'footer-container'
        });
      }

      // 상품 데이터 로드
      loadProducts();
    });

    // 상품 데이터 로드
    function loadProducts() {
      fetch('/api/products')
        .then(response => response.json())
        .then(data => {
          allProducts = data.filter(p => p['셀러공급Y/N'] !== '미공급상품');
        })
        .catch(error => {
          console.error('데이터 로드 실패:', error);
          // 샘플 데이터
          allProducts = [
            { 옵션명: '딸기 1kg', 셀러공급가: '15000', 규격1: '1kg', 품종: '딸기' },
            { 옵션명: '딸기 2kg', 셀러공급가: '28000', 규격1: '2kg', 품종: '딸기' },
            { 옵션명: '사과 5kg', 셀러공급가: '35000', 규격1: '5kg', 품종: '사과' },
            { 옵션명: '배 10kg', 셀러공급가: '45000', 규격1: '10kg', 품종: '배' }
          ];
        });
    }

    // 상품 검색
    function searchProducts(query) {
      const resultsDiv = document.getElementById('searchResults');
      
      if (query.length < 2) {
        resultsDiv.classList.remove('active');
        return;
      }

      const filtered = allProducts.filter(p => {
        const searchFields = [
          p.품종 || '',
          p.품목 || '',
          p.옵션명 || '',
          p.옵션코드 || ''
        ].join(' ').toLowerCase();
        
        return searchFields.includes(query.toLowerCase());
      }).slice(0, 10);

      if (filtered.length > 0) {
        resultsDiv.innerHTML = filtered.map(product => {
          const price = product.셀러공급가 ? 
            Number(product.셀러공급가.toString().replace(/,/g, '')).toLocaleString() : '0';
          const productJson = JSON.stringify(product).replace(/"/g, '&quot;');
          
          return `
            <div class="search-result-item" onclick="selectProduct(JSON.parse('${productJson}'))">
              <span class="result-option">${product.옵션명 || product.품종 || product.품목}</span>
              <span class="result-price">${price}원</span>
            </div>
          `;
        }).join('');
        resultsDiv.classList.add('active');
      } else {
        resultsDiv.innerHTML = '<div class="search-result-item">검색 결과가 없습니다</div>';
        resultsDiv.classList.add('active');
      }
    }

    // 상품 선택
    function selectProduct(product) {
      selectedProduct = product;
      
      document.getElementById('optionName').value = product.옵션명 || '';
      
      const specs = [product.규격1, product.규격2, product.규격3].filter(s => s).join(' ');
      document.getElementById('productSpec').value = specs;
      
      const price = product.셀러공급가 ? 
        Number(product.셀러공급가.toString().replace(/,/g, '')) : 0;
      document.getElementById('unitPrice').value = price.toLocaleString() + '원';
      
      document.getElementById('productSearch').value = product.옵션명 || '';
      document.getElementById('searchResults').classList.remove('active');
      
      calculateTotal();
    }

    // 총액 계산
    function calculateTotal() {
      const quantity = Number(document.getElementById('quantity').value) || 0;
      const unitPriceStr = document.getElementById('unitPrice').value;
      const unitPrice = Number(unitPriceStr.replace(/[^0-9]/g, '')) || 0;
      const total = quantity * unitPrice;
      
      document.getElementById('totalAmount').textContent = total.toLocaleString() + '원';
    }

    // 폼 초기화
    function resetForm() {
      if (confirm('모든 입력 내용을 초기화하시겠습니까?')) {
        document.getElementById('quickOrderForm').reset();
        document.getElementById('totalAmount').textContent = '0원';
        selectedProduct = null;
      }
    }

    // 폼 제출
    document.getElementById('quickOrderForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      if (!selectedProduct) {
        alert('상품을 선택해주세요.');
        return;
      }
      
      // 2글자 이상 검증
      const nameFields = [
        { id: 'sellerName', label: '판매자' },
        { id: 'orderName', label: '주문자' },
        { id: 'receiverName', label: '수령인' }
      ];
      
      for (let field of nameFields) {
        const value = document.getElementById(field.id).value.trim();
        if (value.length < 2) {
          alert(`${field.label}는 2글자 이상 입력해주세요.`);
          document.getElementById(field.id).focus();
          return;
        }
      }
      
      showOrderConfirmModal();
    });

    // 주문 확인 모달 표시
    function showOrderConfirmModal() {
      const formData = collectFormData();
      
      const summaryHTML = `
        <div class="summary-row">
          <span class="summary-label">상품명</span>
          <span class="summary-value">${formData.product.optionName}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">규격</span>
          <span class="summary-value">${formData.product.spec || '-'}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">단가</span>
          <span class="summary-value">${Number(formData.product.unitPrice).toLocaleString()}원</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">수량</span>
          <span class="summary-value">${formData.product.quantity}개</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">판매자</span>
          <span class="summary-value">${formData.seller.name} (${formData.seller.phone})</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">주문자</span>
          <span class="summary-value">${formData.orderer.name} (${formData.orderer.phone})</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">수령인</span>
          <span class="summary-value">${formData.receiver.name} (${formData.receiver.phone})</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">배송지</span>
          <span class="summary-value">${formData.receiver.address}</span>
        </div>
        ${formData.receiver.request ? `
        <div class="summary-row">
          <span class="summary-label">배송 요청사항</span>
          <span class="summary-value">${formData.receiver.request}</span>
        </div>` : ''}
        ${formData.memo ? `
        <div class="summary-row">
          <span class="summary-label">메모</span>
          <span class="summary-value">${formData.memo}</span>
        </div>` : ''}
        <div class="summary-total">
          <span class="summary-label">총 주문금액</span>
          <span class="summary-value">${Number(formData.product.totalAmount).toLocaleString()}원</span>
        </div>
      `;
      
      document.getElementById('orderSummary').innerHTML = summaryHTML;
      document.getElementById('orderConfirmModal').classList.add('show');
    }

    // 폼 데이터 수집
    function collectFormData() {
      return {
        timestamp: new Date().toISOString(),
        product: {
          optionName: document.getElementById('optionName').value,
          spec: document.getElementById('productSpec').value,
          quantity: document.getElementById('quantity').value,
          unitPrice: document.getElementById('unitPrice').value.replace(/[^0-9]/g, ''),
          totalAmount: document.getElementById('totalAmount').textContent.replace(/[^0-9]/g, '')
        },
        seller: {
          name: document.getElementById('sellerName').value,
          phone: document.getElementById('sellerPhone').value
        },
        orderer: {
          name: document.getElementById('orderName').value,
          phone: document.getElementById('orderPhone').value
        },
        receiver: {
          name: document.getElementById('receiverName').value,
          phone: document.getElementById('receiverPhone').value,
          address: document.getElementById('address').value,
          request: document.getElementById('deliveryRequest').value
        },
        memo: document.getElementById('orderMemo').value
      };
    }

    // 모달 닫기
    function closeConfirmModal() {
      document.getElementById('orderConfirmModal').classList.remove('show');
    }

    // 최종 제출
    function finalSubmit() {
      const formData = collectFormData();
      
      saveToGoogleSheets(formData);
      
      alert('주문이 완료되었습니다!\n입금 확인 후 발송 예정입니다.');
      
      closeConfirmModal();
      resetForm();
    }

    // 계좌번호 복사
    function copyAccountNumber() {
      const accountNumber = '302-1473-7870-91';
      
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(accountNumber).then(() => {
          showCopySuccess();
        }).catch(() => {
          fallbackCopy(accountNumber);
        });
      } else {
        fallbackCopy(accountNumber);
      }
    }

    // 복사 성공 메시지
    function showCopySuccess() {
      const successMsg = document.getElementById('copySuccess');
      successMsg.classList.add('show');
      setTimeout(() => {
        successMsg.classList.remove('show');
      }, 2000);
    }

    // 구형 브라우저 복사
    function fallbackCopy(text) {
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.left = '-999999px';
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      
      try {
        document.execCommand('copy');
        showCopySuccess();
      } catch (err) {
        alert('계좌번호: ' + text);
      }
      
      document.body.removeChild(textArea);
    }

    // Google Sheets 저장
    function saveToGoogleSheets(data) {
      console.log('Google Sheets에 저장할 데이터:', data);
      // 실제 구현 시:
      // fetch('YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL', {
      //   method: 'POST',
      //   headers: { 'Content-Type': 'application/json' },
      //   body: JSON.stringify(data)
      // });
    }

    // 전화번호 자동 포맷팅
    ['sellerPhone', 'orderPhone', 'receiverPhone'].forEach(id => {
      document.getElementById(id).addEventListener('input', function(e) {
        let value = e.target.value.replace(/[^0-9]/g, '');
        if (value.length > 3 && value.length <= 7) {
          value = value.slice(0, 3) + '-' + value.slice(3);
        } else if (value.length > 7) {
          value = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7, 11);
        }
        e.target.value = value;
      });
    });

    // 검색창 외부 클릭 시 닫기
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.search-input-wrapper')) {
        document.getElementById('searchResults').classList.remove('active');
      }
    });

    // 모달 외부 클릭 시 닫기
    document.getElementById('orderConfirmModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeConfirmModal();
      }
    });
  </script>
</body>
</htm
