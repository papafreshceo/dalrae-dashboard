<!DOCTYPE html>
<html lang="ko">
<head>
  <base target="_top">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="icon" type="image/png" href="/favicon.png" />
  <title>발주시스템 안내</title>
  <script src="header.js"></script>
  <style>
    body { 
      font-family: 'Noto Sans KR', -apple-system, sans-serif; 
      background: #f8f9fa; 
      color: #212529; 
      margin: 0;
      padding: 0;
    }

    .hero {
      min-height: calc(100vh - 200px);
      padding: 40px 20px; 
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    }
    
    .card { 
      max-width: 880px; 
      margin: 0 auto;
      background: white; 
      border-radius: 16px; 
      padding: 40px; 
      box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
    }
    
    .eyebrow { 
      font-size: 14px; 
      font-weight: 700; 
      letter-spacing: .06em; 
      color: #6c757d; 
      text-transform: uppercase; 
      margin-bottom: 12px; 
    }
    
    .title { 
      font-size: 36px; 
      line-height: 1.25; 
      font-weight: 800; 
      color: #212529; 
      margin-bottom: 16px; 
    }
    
    .subtitle { 
      font-size: 16px; 
      color: #495057; 
      line-height: 1.6;
      margin-bottom: 28px; 
    }

    .cta-wrap { 
      display: flex; 
      gap: 12px; 
      align-items: center; 
      margin-bottom: 40px;
    }

    .special-order-btn {
      padding: 14px 32px; 
      border: none; 
      border-radius: 8px; 
      font-weight: 700; 
      font-size: 18px; 
      cursor: pointer;
      background: #2563eb;
      color: white;
      transition: all 0.2s;
    }
    
    .special-order-btn:hover { 
      background: #1d4ed8;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    .divider {
      width: 100%;
      height: 1px;
      background: #dee2e6;
      margin: 40px 0;
    }

    .form-title {
      font-size: 24px;
      font-weight: 700;
      color: #212529;
      margin-bottom: 8px;
      text-align: center;
    }

    .form-subtitle {
      font-size: 14px;
      color: #6c757d;
      text-align: center;
      margin-bottom: 30px;
    }

    /* 상품 검색 */
    .product-search-section {
      margin-bottom: 20px;
    }

    .search-input-wrapper {
      position: relative;
      margin-bottom: 10px;
    }

    .product-search {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      font-size: 15px;
      transition: all 0.2s;
    }

    .product-search:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    /* 검색 결과 리스트 */
    .search-results {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      background: white;
      display: none;
    }

    .search-results.active {
      display: block;
    }

    .search-result-item {
      padding: 12px 16px;
      cursor: pointer;
      border-bottom: 1px solid #f1f3f5;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background 0.2s;
    }

    .search-result-item:hover {
      background: #f8f9fa;
    }

    .search-result-item:last-child {
      border-bottom: none;
    }

    .result-option {
      font-size: 14px;
      color: #212529;
      font-weight: 500;
    }

    .result-price {
      font-size: 14px;
      color: #2563eb;
      font-weight: 600;
    }

    /* 폼 스타일 */
    .order-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    .form-label {
      font-size: 13px;
      color: #495057;
      font-weight: 600;
    }

    .form-label .required {
      color: #dc3545;
    }

    .form-input {
      padding: 10px 14px;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      font-size: 14px;
      color: #212529;
      background: white;
      transition: all 0.2s;
    }

    .form-input:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .form-input:disabled {
      background: #f8f9fa;
      color: #6c757d;
      cursor: not-allowed;
    }

    .form-input.error {
      border-color: #dc3545;
    }

    textarea.form-input {
      resize: vertical;
      min-height: 80px;
    }

    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      opacity: 1;
      height: 30px;
    }

    /* 금액 표시 */
    .price-display {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      margin: 20px 0;
    }

    .price-label {
      font-size: 14px;
      color: #6c757d;
      margin-bottom: 8px;
    }

    .price-amount {
      font-size: 28px;
      font-weight: 700;
      color: #212529;
    }

    /* 버튼 */
    .submit-section {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }

    .btn {
      flex: 1;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-reset {
      background: #f8f9fa;
      color: #495057;
      border: 1px solid #dee2e6;
    }

    .btn-reset:hover {
      background: #e9ecef;
    }

    .btn-submit {
      background: #2563eb;
      color: white;
    }

    .btn-submit:hover {
      background: #1d4ed8;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    .btn-submit:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .phone-contact {
      text-align: center;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #dee2e6;
      font-size: 14px;
      color: #6c757d;
    }

    .phone-link {
      color: #2563eb;
      text-decoration: none;
      font-weight: 600;
      margin-left: 6px;
    }

    .phone-link:hover {
      text-decoration: underline;
    }

    /* 모바일 반응형 */
    @media (max-width: 640px) {
      .hero {
        padding: 20px 15px;
      }
      
      .card {
        padding: 25px 20px;
        border-radius: 12px;
      }
      
      .title {
        font-size: 28px;
      }
      
      .subtitle {
        font-size: 14px;
      }
      
      .special-order-btn {
        width: 100%;
        font-size: 16px;
        padding: 12px 20px;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .price-amount {
        font-size: 24px;
      }

      .submit-section {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <!-- 공통 헤더 컨테이너 -->
  <div id="header-container"></div>

  <!-- 본문 -->
  <main class="hero">
    <section class="card">
      <div class="eyebrow">Order Guide</div>
      <h1 class="title">주문은 <strong style="color:#2563eb">발주시스템</strong>을 이용해 주세요</h1>
      <p class="subtitle">
        다수의 주문은 발주시스템을 이용하시면 더욱 편리합니다.<br>
        정확한 주문관리 정산을 위해 발주시스템을 이용해주세요.
      </p>

      <div class="cta-wrap">
        <button class="special-order-btn" onclick="window.open('https://papafarmers.com/orders/', '_blank')">
          발주시스템 바로가기
        </button>
      </div>

      <div class="divider"></div>

      <!-- 주문 폼 -->
      <div class="order-form-section">
        <h2 class="form-title">빠른 주문서</h2>
        <p class="form-subtitle">간편하게 주문하실 수 있습니다</p>

        <form class="order-form" id="quickOrderForm">
          <!-- 상품 검색 -->
          <div class="product-search-section">
            <div class="form-group full-width">
              <label class="form-label">상품 검색 <span class="required">*</span></label>
              <div class="search-input-wrapper">
                <input type="text" class="product-search" id="productSearch" 
                       placeholder="상품명, 품종, 옵션명으로 검색..." 
                       oninput="searchProducts(this.value)">
                <div class="search-results" id="searchResults"></div>
              </div>
            </div>
          </div>

          <!-- 선택된 상품 정보 -->
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">옵션명</label>
              <input type="text" class="form-input" id="optionName" readonly>
            </div>
            <div class="form-group">
              <label class="form-label">규격</label>
              <input type="text" class="form-input" id="productSpec" readonly>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">수량 <span class="required">*</span></label>
              <input type="number" class="form-input" id="quantity" min="1" value="1" required onchange="calculateTotal()">
            </div>
            <div class="form-group">
              <label class="form-label">단가</label>
              <input type="text" class="form-input" id="unitPrice" readonly>
            </div>
          </div>

          <div class="divider"></div>

          <!-- 판매자 정보 -->
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">판매자명 <span class="required">*</span></label>
              <input type="text" class="form-input" id="sellerName" placeholder="판매자명" required>
            </div>
            <div class="form-group">
              <label class="form-label">판매자 연락처 <span class="required">*</span></label>
              <input type="tel" class="form-input" id="sellerPhone" placeholder="010-0000-0000" required>
            </div>
          </div>

          <div class="divider"></div>

          <!-- 주문자 정보 -->
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">주문자명 <span class="required">*</span></label>
              <input type="text" class="form-input" id="orderName" placeholder="주문자명" required>
            </div>
            <div class="form-group">
              <label class="form-label">주문자 연락처 <span class="required">*</span></label>
              <input type="tel" class="form-input" id="orderPhone" placeholder="010-0000-0000" required>
            </div>
          </div>

          <div class="divider"></div>

          <!-- 수령인 정보 -->
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">수령인명 <span class="required">*</span></label>
              <input type="text" class="form-input" id="receiverName" placeholder="수령인명" required>
            </div>
            <div class="form-group">
              <label class="form-label">수령인 연락처 <span class="required">*</span></label>
              <input type="tel" class="form-input" id="receiverPhone" placeholder="010-0000-0000" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group full-width">
              <label class="form-label">배송 주소 <span class="required">*</span></label>
              <input type="text" class="form-input" id="address" placeholder="배송받을 주소를 입력하세요" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group full-width">
              <label class="form-label">배송 요청사항</label>
              <textarea class="form-input" id="deliveryRequest" placeholder="배송 시 요청사항을 입력하세요"></textarea>
            </div>
          </div>

          <!-- 총 금액 -->
          <div class="price-display">
            <div class="price-label">총 주문금액</div>
            <div class="price-amount" id="totalAmount">0원</div>
          </div>

          <!-- 버튼 -->
          <div class="submit-section">
            <button type="button" class="btn btn-reset" onclick="resetForm()">초기화</button>
            <button type="submit" class="btn btn-submit">주문 제출</button>
          </div>
        </form>
      </div>

      <!-- 문의 전화번호 -->
      <div class="phone-contact">
        <span>문의</span>
        <a class="phone-link" href="tel:010-2688-1388">010-2688-1388</a>
      </div>
    </section>
  </main>

  <script>
    // 샘플 상품 데이터 (실제로는 API에서 가져옴)
    let allProducts = [];
    let selectedProduct = null;

    // 페이지 로드 시 데이터 가져오기
    window.addEventListener('DOMContentLoaded', function() {
      // 헤더 설정
      setTimeout(() => {
        if (window.DalraeHeader && window.DalraeHeader.setActivePage) {
          window.DalraeHeader.setActivePage('orders');
        }
      }, 200);

      // 상품 데이터 로드
      loadProducts();
    });

    // 상품 데이터 로드
    function loadProducts() {
      fetch('/api/products')
        .then(response => response.json())
        .then(data => {
          allProducts = data.filter(p => p['셀러공급Y/N'] !== '미공급상품');
        })
        .catch(error => {
          console.error('데이터 로드 실패:', error);
          // 샘플 데이터 사용
          allProducts = [
            { 옵션명: '딸기 1kg', 셀러공급가: '15000', 규격1: '1kg', 품종: '딸기' },
            { 옵션명: '딸기 2kg', 셀러공급가: '28000', 규격1: '2kg', 품종: '딸기' },
            { 옵션명: '사과 5kg', 셀러공급가: '35000', 규격1: '5kg', 품종: '사과' },
            { 옵션명: '배 10kg', 셀러공급가: '45000', 규격1: '10kg', 품종: '배' }
          ];
        });
    }

    // 상품 검색
    function searchProducts(query) {
      const resultsDiv = document.getElementById('searchResults');
      
      if (query.length < 2) {
        resultsDiv.classList.remove('active');
        return;
      }

      const filtered = allProducts.filter(p => {
        const searchFields = [
          p.품종 || '',
          p.품목 || '',
          p.옵션명 || '',
          p.옵션코드 || ''
        ].join(' ').toLowerCase();
        
        return searchFields.includes(query.toLowerCase());
      }).slice(0, 10); // 최대 10개만 표시

      if (filtered.length > 0) {
        resultsDiv.innerHTML = filtered.map(product => {
          const price = product.셀러공급가 ? 
            Number(product.셀러공급가.toString().replace(/,/g, '')).toLocaleString() : '0';
          
          return `
            <div class="search-result-item" onclick="selectProduct(${JSON.stringify(product).replace(/"/g, '&quot;')})">
              <span class="result-option">${product.옵션명 || product.품종 || product.품목}</span>
              <span class="result-price">${price}원</span>
            </div>
          `;
        }).join('');
        resultsDiv.classList.add('active');
      } else {
        resultsDiv.innerHTML = '<div class="search-result-item">검색 결과가 없습니다</div>';
        resultsDiv.classList.add('active');
      }
    }

    // 상품 선택
    function selectProduct(product) {
      selectedProduct = product;
      
      // 옵션명 입력
      document.getElementById('optionName').value = product.옵션명 || '';
      
      // 규격 입력
      const specs = [product.규격1, product.규격2, product.규격3].filter(s => s).join(' ');
      document.getElementById('productSpec').value = specs;
      
      // 단가 입력
      const price = product.셀러공급가 ? 
        Number(product.셀러공급가.toString().replace(/,/g, '')) : 0;
      document.getElementById('unitPrice').value = price.toLocaleString() + '원';
      
      // 검색창 초기화
      document.getElementById('productSearch').value = product.옵션명 || '';
      document.getElementById('searchResults').classList.remove('active');
      
      // 총액 계산
      calculateTotal();
    }

    // 총액 계산
    function calculateTotal() {
      const quantity = Number(document.getElementById('quantity').value) || 0;
      const unitPriceStr = document.getElementById('unitPrice').value;
      const unitPrice = Number(unitPriceStr.replace(/[^0-9]/g, '')) || 0;
      const total = quantity * unitPrice;
      
      document.getElementById('totalAmount').textContent = total.toLocaleString() + '원';
    }

    // 폼 초기화
    function resetForm() {
      if (confirm('모든 입력 내용을 초기화하시겠습니까?')) {
        document.getElementById('quickOrderForm').reset();
        document.getElementById('totalAmount').textContent = '0원';
        selectedProduct = null;
      }
    }

    // 폼 제출
    document.getElementById('quickOrderForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      if (!selectedProduct) {
        alert('상품을 선택해주세요.');
        return;
      }
      
      // 폼 데이터 수집
      const formData = {
        timestamp: new Date().toISOString(),
        product: {
          optionName: document.getElementById('optionName').value,
          spec: document.getElementById('productSpec').value,
          quantity: document.getElementById('quantity').value,
          unitPrice: document.getElementById('unitPrice').value.replace(/[^0-9]/g, ''),
          totalAmount: document.getElementById('totalAmount').textContent.replace(/[^0-9]/g, '')
        },
        seller: {
          name: document.getElementById('sellerName').value,
          phone: document.getElementById('sellerPhone').value
        },
        orderer: {
          name: document.getElementById('orderName').value,
          phone: document.getElementById('orderPhone').value
        },
        receiver: {
          name: document.getElementById('receiverName').value,
          phone: document.getElementById('receiverPhone').value,
          address: document.getElementById('address').value,
          request: document.getElementById('deliveryRequest').value
        }
      };
      
      // Google Sheets에 저장 (실제 구현 필요)
      saveToGoogleSheets(formData);
      
      alert('주문이 접수되었습니다!\n\n' + 
            '상품: ' + formData.product.optionName + '\n' +
            '수량: ' + formData.product.quantity + '\n' +
            '총액: ' + formData.product.totalAmount + '원');
      
      resetForm();
    });

    // Google Sheets 저장 (구현 필요)
    function saveToGoogleSheets(data) {
      // 여기에 Google Apps Script Web App URL을 사용한 저장 로직 구현
      console.log('Google Sheets에 저장할 데이터:', data);
      
      // 예시:
      // fetch('YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL', {
      //   method: 'POST',
      //   headers: { 'Content-Type': 'application/json' },
      //   body: JSON.stringify(data)
      // });
    }

    // 전화번호 자동 포맷팅
    ['sellerPhone', 'orderPhone', 'receiverPhone'].forEach(id => {
      document.getElementById(id).addEventListener('input', function(e) {
        let value = e.target.value.replace(/[^0-9]/g, '');
        if (value.length > 3 && value.length <= 7) {
          value = value.slice(0, 3) + '-' + value.slice(3);
        } else if (value.length > 7) {
          value = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7, 11);
        }
        e.target.value = value;
      });
    });

    // 검색창 외부 클릭 시 닫기
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.search-input-wrapper')) {
        document.getElementById('searchResults').classList.remove('active');
      }
    });
  </script>
</body>
</html>
